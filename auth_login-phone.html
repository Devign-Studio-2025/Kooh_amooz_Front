<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ورود با شماره - کوه‌آموز</title>
    <link rel="icon" type="image/x-icon" href="assets/imgs/logoes/just-logo.png" />
    <!-- ! Core Styles -->
    <link rel="stylesheet" href="assets/css/main.css" />
    <!-- ! Page Styles -->
    <link rel="stylesheet" href="assets/css/pages/auth/auth-main.css" />
</head>

<body>

    <main class="main-website auth">
        <section class="auth__container">
            <div class="auth__right">
                <h2 class="auth__form-title">ورود به حساب</h2>
                <form action="#" class="auth__form" id="login-phone-form">
                    <div class="auth__form-inputs">
                        <div class="auth__input input__with-error-wrapper">
                            <div class="input">
                                <input class="input__field input__field--have-icon" placeholder="" autocomplete="off"
                                    type="tel" name="phone-number" id="phone-number" minlength="11" maxlength="11"  />
                                <span class="input__placeholder">
                                    شماره همراه
                                </span>
                                <span class="input__icon">
                                    <svg class="icon icon--md" viewBox="0 0 24 24">
                                        <use href="assets/icons/sprites.svg#solar:phone-bold-duotone"></use>
                                    </svg>
                                </span>
                            </div>
                        </div>
                    </div>
                    <button class="button button--xs button--disabled w-100" id="login-phone-submit-btn">
                        <span class="button__text">ورود</span>
                    </button>

                    <a class="auth__link" href="auth_login-password.html">ورود با رمز عبور</a>

                </form>
                <p class="auth__form-footer">
                    حساب کاربری ندارید؟
                    <a class="auth__link" href="auth_register.html">ثبت نام</a>
                </p>
            </div>
            <div class="auth__left">
                <img class="auth__left-bg-img" src="assets/imgs/auth-bg/bg-register.jpg" alt="">
                <div class="auth__left-info">
                    <img class="auth__logo" src="assets/imgs/logoes/logo.png"></img>
                    <p class="auth__text">
                        کوه‌آموز با شعار «آموزشگاه آنلاین کوهنوردی ایران» پلتفرمی تخصصی برای یادگیری ایمن، اصولی و
                        استاندارد در تمام رده‌های مهارتی—از مبتدی تا حرفه‌ای—در حوزه‌ی کوهستان است.
                    </p>
                </div>
            </div>
        </section>
        <section class="auth-footer">
            <p> <svg class="icon icon--md" viewBox="0 0 24 24">
                    <use href="assets/icons/sprites.svg#vuesax/bulk/copyright"></use>
                </svg> کلیه حقوق این پلتفرم متعلق به <strong>کوه‌آموز</strong> می‌باشد.</p>
        </section>
    </main>

    <!-- ! Page Scripts -->
    <!-- jQuery -->
    <script src="assets/libs/jquery/jquery-3.7.1.min.js"></script>
    <!-- Just Validate -->
    <script src="assets/libs/validate.min.js/just-validate.production.min.js"></script>

    <script>
        // ================== Form State Manager and button state management ================== //
        // Monitors form fields in real-time and updates submit button accordingly

        class FormStateManager {
            constructor() {
                // Form and button selectors
                this.formId = '#login-phone-form';
                this.submitBtnId = '#login-phone-submit-btn';

                this.requiredFields = [
                    '#phone-number',
                ];

                this.validator = null; // Will hold JustValidate instance
                this.init();
            }


            // Initialize form validation and state management

            init() {
                this.initializeValidation();
                this.bindRealTimeValidation();
                this.updateButtonState();
            }


            // Initialize JustValidate with custom rules and configuration
            initializeValidation() {
                const validateOptions = {
                    errorFieldCssClass: "is-invalid",
                    errorLabelStyle: {
                        color: "var(--Color-Text-icon-on-subtle-error)",
                        font: "var(--Font-Caption-bold-style)",
                        marginTop: "var(--Spacing-sm)",
                        display: "block",
                    },
                    successFieldCssClass: "is-valid",
                    validateOnBlur: true, // Validate when field loses focus
                    focusInvalidField: true, // Auto-focus first invalid field
                    lockForm: false // Don't lock form on validation failure
                };

                this.validator = new JustValidate(this.formId, validateOptions);

                // validation rules
                this.validator
                    .addField("#phone-number", [
                        {
                            rule: "required",
                            errorMessage: "شماره همراه الزامی است",
                        },
                        {
                            rule: "number",
                            errorMessage: "فقط عدد مجاز است",
                        },
                        {
                            rule: "minLength",
                            value: 11,
                            errorMessage: "شماره باید ۱۱ رقمی باشد",
                        },
                        {
                            rule: "maxLength",
                            value: 11,
                            errorMessage: "شماره باید ۱۱ رقمی باشد",
                        },
                        {
                            rule: "customRegexp",
                            value: /^09[0-9]{9}$/,
                            errorMessage: "شماره موبایل معتبر وارد کنید ",
                        },
                    ], {
                        errorsContainer: document.querySelector("#phone-number").closest(".input__with-error-wrapper"),
                    })
                    .onSuccess(() => {
                        this.handleFormSubmission();
                    })
                    .onFail(() => {
                        // When validation fails, update button state
                        this.updateButtonState();
                    });
            }

            /**
             * Bind real-time validation monitoring to all form fields
             * This ensures button state updates immediately when fields change
             */
            bindRealTimeValidation() {
                // Monitor input events on all required fields
                this.requiredFields.forEach(field => {
                    $(document).on('input change', field, () => {
                        this.updateButtonState();
                    });
                });
            }

            /**
             * Update submit button state based on form validity
             * Enables button and adds primary style when form is valid
             * Disables button and adds disabled style when form is invalid
             */
            updateButtonState() {
                const submitBtn = document.querySelector(this.submitBtnId);
                const isFormValid = this.isFormValid();

                if (isFormValid) {
                    // Form is valid - enable button with primary style
                    submitBtn.disabled = false;
                    submitBtn.classList.remove("button--disabled");
                    submitBtn.classList.add("button--primary");
                } else {
                    // Form is invalid - disable button with disabled style
                    submitBtn.disabled = true;
                    submitBtn.classList.add("button--disabled");
                    submitBtn.classList.remove("button--primary");
                }
            }

            /**
             * Check if all form fields are valid
             * @returns {boolean} True if form is valid, false otherwise
             */
            isFormValid() {
                // Check if all required fields have values
                const fieldsValid = this.requiredFields.every(field => {
                    const element = document.querySelector(field);
                    if (!element) return false;

                    // For text inputs, check if value is not empty
                    return element.value.trim() !== '';
                });

                return fieldsValid;
            }

            /**
             * Handle form submission when validation passes
             * Updates button state and submits the form
             */
            handleFormSubmission() {
                const submitBtn = document.querySelector(this.submitBtnId);

                // Update button to show loading state
                submitBtn.disabled = true;
                submitBtn.classList.remove("button--disabled");
                submitBtn.classList.add("button--primary");

                // Change button text to indicate processing
                submitBtn.querySelector('.button__text').textContent = 'در حال ثبت...';

                // Submit the form (this will send data to backend)
                document.querySelector(this.formId).submit();
            }
        }

        // ================== Initialize All Managers ================== //
        // This section initializes all functionality when document is ready
        // All managers are attached to window for global access if needed

        $(document).ready(function () {

            // Initialize form validation and button state manager
            window.formStateManager = new FormStateManager();

            // Log initialization for debugging
            console.log('All form managers initialized successfully');
        });
    </script>
</body>

</html>